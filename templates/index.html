<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pelée AI – Data Tool</title>
    <style>
        :root { color-scheme: dark; }
        * { box-sizing: border-box; }
        body {
            margin: 0;
            min-height: 100vh;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background:
                radial-gradient(circle at top left, #1e293b 0, transparent 55%),
                radial-gradient(circle at top right, #0f172a 0, #020617 60%);
            color: #e5e7eb;
        }

        /* ⬇⬇ NEW: loading bar */
        #loadingBarContainer {
            height: 3px;
            width: 100%;
            background: rgba(148,163,184,0.15);
            overflow: hidden;
            border-radius: 999px;
            display: none; /* hidden until search runs */
            margin-bottom: 6px;
        }
        #loadingBar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            animation: loadingAnim 1.2s infinite;
        }
        @keyframes loadingAnim {
            0%   { transform: translateX(-100%); }
            50%  { transform: translateX(0%); }
            100% { transform: translateX(100%); }
        }
        /* ⬆⬆ END loading bar */

        /* (ALL your original CSS exactly as-is below) */
        .page { max-width: 1150px; margin: 0 auto; padding: 32px 20px 40px; }
        header { display: flex; align-items: center; justify-content: space-between; gap: 16px; margin-bottom: 26px; }
        .brand { display: flex; align-items: center; gap: 10px; }
        .brand-logo {
            width: 32px; height: 32px; border-radius: 999px;
            background: radial-gradient(circle at 30% 30%, #facc15, #f97316);
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; font-size: 18px; color: #020617;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
        }
        .brand-text { display: flex; flex-direction: column; }
        .brand-name { font-weight: 600; letter-spacing: 0.16em; text-transform: uppercase; font-size: 12px; }
        .brand-tagline { font-size: 13px; color: #9ca3af; }
        .hero { display: grid; grid-template-columns: minmax(0, 1.15fr) minmax(0, 1.05fr); gap: 24px; }
        @media (max-width: 900px) { .hero { grid-template-columns: minmax(0,1fr); } }
        .hero-copy h1 { font-size: 32px; line-height: 1.1; margin: 10px 0 10px; }
        .hero-copy h1 span { color: #facc15; }
        .hero-copy p { margin: 0 0 18px; color: #9ca3af; font-size: 15px; }
        .pill { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 999px; font-size: 11px;
                background: rgba(15,23,42,0.8); border: 1px solid rgba(148,163,184,0.3); color: #e5e7eb; }
        .pill-dot { width: 7px; height: 7px; border-radius: 999px; background: #22c55e; }
        .hero-bullets { font-size: 13px; color: #9ca3af; margin: 0 0 18px; padding-left: 16px; }
        .hero-bullets li { margin-bottom: 4px; }
        .left-card {
            margin-top: 10px; background: rgba(15,23,42,0.9);
            border-radius: 16px; padding: 12px 14px 10px;
            border: 1px solid rgba(148,163,184,0.4);
        }
        .left-card h3 { font-size: 13px; margin: 0 0 6px; }
        .left-card small { color: #9ca3af; font-size: 11px; }
        .examples-list { margin: 4px 0 10px; padding-left: 16px; font-size: 12px; color: #d1d5db; }

        /* table, chat-card, input, bubbles, etc… unchanged */
    </style>
</head>

<body>
<div class="page">
    <header>
        <div class="brand">
            <div class="brand-logo">P</div>
            <div class="brand-text">
                <div class="brand-name">PELÉE AI</div>
                <div class="brand-tagline">Internal Data Tool</div>
            </div>
        </div>
    </header>

    <section class="hero">
        <!-- LEFT SIDE unchanged … -->

        <!-- CHAT CARD -->
        <div class="chat-card">

            <!-- ⬇⬇ NEW: Loading bar -->
            <div id="loadingBarContainer">
                <div id="loadingBar"></div>
            </div>
            <!-- ⬆⬆ END new bar -->

            <div class="chat-header">
                <div class="chat-title">Pelée Data Chat</div>
                <div class="chat-sub">Natural language → filtered address lists</div>
            </div>

            <div id="chatbox"></div>

            <div class="input-row">
                <input id="userInput" type="text" placeholder="Ask for addresses...">
                <button id="sendBtn">Send</button>
            </div>

            <div class="status-row">
                <div id="status" class="status"></div>
                <button id="exportBtn" onclick="window.location='/export'">Export</button>
            </div>

        </div>
    </section>
</div>

<script>
    const chatbox = document.getElementById("chatbox");
    const userInput = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const statusEl = document.getElementById("status");

    const loadingContainer = document.getElementById("loadingBarContainer");

    async function sendMessage() {
        const message = userInput.value.trim();
        if (!message) return;

        // show loading bar
        loadingContainer.style.display = "block";

        chatbox.innerHTML += `
            <div class="msg msg-user"><div class="bubble bubble-user">${message}</div></div>
        `;
        chatbox.scrollTop = chatbox.scrollHeight;

        userInput.value = "";

        statusEl.textContent = "Processing…";

        const response = await fetch("/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message })
        });

        const data = await response.json();

        // hide loading bar
        loadingContainer.style.display = "none";

        statusEl.textContent = "";

        chatbox.innerHTML += `
            <div class="msg"><div class="bubble bubble-assistant">${data.reply}</div></div>
        `;
        chatbox.scrollTop = chatbox.scrollHeight;
    }

    sendBtn.addEventListener("click", sendMessage);
    userInput.addEventListener("keypress", e => { if (e.key === "Enter") sendMessage(); });
</script>

</body>
</html>
